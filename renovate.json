{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "pinDigests": true,
  "enabledManagers": [
    "docker-compose"
  ],
  "labels": [
    "renovate"
  ],
  "vulnerabilityAlerts": {
    "labels": [
      "security"
    ]
  },
  "packageRules": [
    {
      "description": "Label by update type",
      "matchUpdateTypes": [
        "major",
        "minor",
        "patch",
        "digest",
        "pin"
      ],
      "addLabels": [
        "update:{{updateType}}"
      ]
    },
    {
      "description": "Immich server requires manual review (v2.x only)",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": [
        "^ghcr\\.io/immich-app/immich-server$",
        "^ghcr\\.io/immich-app/immich-machine-learning$"
      ],
      "allowedVersions": ">=2.0.0 <3.0.0",
      "addLabels": ["stack:immich", "manual-merge"],
      "automerge": false
    },
    {
      "description": "Keep Immich Postgres locked; manual bump only",
      "matchDatasources": ["docker"],
      "matchFileNames": ["**/stacks/immich/**"],
      "matchPackagePatterns": ["^ghcr\\.io/immich-app/postgres$"],
      "enabled": false,
      "addLabels": ["stack:immich", "component:postgres", "locked"]
    },
    {
      "description": "code-server versioning (use upstream semver, stay on v4)",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "lscr.io/linuxserver/code-server"
      ],
      "matchFileNames": [
        "**/stacks/code-server/**"
      ],
      "extractVersion": "^(?<version>\\d+\\.\\d+\\.\\d+)",
      "allowedVersions": ">=4.0.0 <5.0.0"
    },
    {
      "description": "code-server (safe, automerge minor/patch/digest)",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "lscr.io/linuxserver/code-server"
      ],
      "matchFileNames": [
        "**/stacks/code-server/**"
      ],
      "matchUpdateTypes": [
        "minor",
        "patch",
        "digest"
      ],
      "addLabels": [
        "stack:code-server",
        "safe",
        "automerge"
      ],
      "automerge": true,
      "platformAutomerge": true
    },
    {
      "description": "valkey (redis) safe, automerge minor/patch/digest",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "docker.io/valkey/valkey"
      ],
      "matchFileNames": [
        "**/stacks/immich/**"
      ],
      "matchUpdateTypes": [
        "minor",
        "patch",
        "digest"
      ],
      "addLabels": [
        "stack:immich",
        "component:valkey",
        "safe",
        "automerge"
      ],
      "automerge": true,
      "platformAutomerge": true
    },
    {
      "description": "Keep Immich Postgres locked; manual bump only",
      "matchDatasources": [
        "docker"
      ],
      "matchFileNames": [
        "**/stacks/immich/**"
      ],
      "enabled": false,
      "addLabels": [
        "stack:immich",
        "component:postgres",
        "locked"
      ],
      "matchPackageNames": [
        "/^ghcr\\.io/immich-app/postgres$/"
      ]
    }
  ],
  "prHourlyLimit": 4,
  "minimumReleaseAge": "1 day",
  "schedule": [
    "after 02:00 and before 06:00 on sunday"
  ]
}

