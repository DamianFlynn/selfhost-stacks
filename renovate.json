{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "pinDigests": false,
  "enabledManagers": [
    "docker-compose",
    "dockerfile"
  ],
  "docker-compose": {
    "managerFilePatterns": [
      "/(^|/)(compose\\.ya?ml|docker-compose\\.ya?ml)$/",
      "/traefik/authelia\\.ya?ml$/",
      "/traefik/socket-proxy\\.ya?ml$/",
      "/traefik/traefik\\.ya?ml$/"
    ]
  },
  "labels": [
    "renovate"
  ],
  "vulnerabilityAlerts": {
    "labels": [
      "security"
    ]
  },
  "packageRules": [
    {
      "description": "Label by update type",
      "matchUpdateTypes": [
        "major",
        "minor",
        "patch",
        "digest",
        "pin"
      ],
      "addLabels": [
        "update:{{updateType}}"
      ]
    },
    {
      "description": "Default: Auto-merge patch and digest updates for all Docker images",
      "matchDatasources": [
        "docker"
      ],
      "matchUpdateTypes": [
        "patch",
        "digest"
      ],
      "addLabels": [
        "automerge",
        "safe"
      ],
      "automerge": true,
      "platformAutomerge": true,
      "schedule": [
        "at any time"
      ],
      "minimumReleaseAge": "1 hour"
    },
    {
      "description": "Default: Auto-merge minor updates for all Docker images",
      "matchDatasources": [
        "docker"
      ],
      "matchUpdateTypes": [
        "minor"
      ],
      "addLabels": [
        "automerge",
        "safe"
      ],
      "automerge": true,
      "platformAutomerge": true,
      "schedule": [
        "at any time"
      ],
      "minimumReleaseAge": "3 hours"
    },
    {
      "description": "Security: Pin digests for security-critical components",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "traefik",
        "authelia/authelia"
      ],
      "pinDigests": true,
      "addLabels": [
        "security-critical",
        "digest-pinned"
      ]
    },
    {
      "description": "Default: Require manual review for major updates",
      "matchDatasources": [
        "docker"
      ],
      "matchUpdateTypes": [
        "major"
      ],
      "addLabels": [
        "major-update",
        "manual-review-required"
      ],
      "automerge": false
    },
    {
      "description": "Sensitive: PostgreSQL (Immich) - Pin to prevent automatic updates",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "postgres",
        "ghcr.io/immich-app/postgres"
      ],
      "matchFileNames": [
        "**/immich/**",
        "**/stacks/immich/**"
      ],
      "enabled": false,
      "addLabels": [
        "stack:immich",
        "component:postgres",
        "pinned",
        "manual-update-only"
      ]
    },
    {
      "description": "Sensitive: Redis/Valkey (Immich) - Pin to prevent automatic updates",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "redis",
        "valkey/valkey",
        "docker.io/valkey/valkey"
      ],
      "matchFileNames": [
        "**/immich/**",
        "**/stacks/immich/**"
      ],
      "enabled": false,
      "addLabels": [
        "stack:immich",
        "component:redis",
        "pinned",
        "manual-update-only"
      ]
    },
    {
      "description": "Immich: Main applications (server/ML) - Manual review for all updates",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "/immich-server/",
        "/immich-machine-learning/"
      ],
      "matchFileNames": [
        "**/immich/**",
        "**/stacks/immich/**"
      ],
      "automerge": false,
      "addLabels": [
        "stack:immich",
        "component:app",
        "manual-review-required"
      ]
    },
    {
      "description": "Auto-label by stack: Immich",
      "matchFileNames": [
        "**/immich/**",
        "**/stacks/immich/**"
      ],
      "addLabels": [
        "stack:immich"
      ]
    },
    {
      "description": "Auto-label by stack: Traefik",
      "matchFileNames": [
        "**/traefik/**",
        "**/stacks/traefik/**"
      ],
      "addLabels": [
        "stack:traefik"
      ]
    },
    {
      "description": "Auto-label by stack: Code Server",
      "matchFileNames": [
        "**/code-server/**",
        "**/stacks/code-server/**"
      ],
      "addLabels": [
        "stack:code-server"
      ]
    },
    {
      "description": "Auto-label by stack: Generic stacks",
      "matchFileNames": [
        "**/stacks/**"
      ],
      "addLabels": [
        "type:stack"
      ]
    }
  ],
  "prHourlyLimit": 6,
  "minimumReleaseAge": "3 hours",
  "schedule": [
    "at any time"
  ]
}
